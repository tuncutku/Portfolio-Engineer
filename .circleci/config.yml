version: 2.1

############
# Workflows
############
workflows:
  version: 2
  build-deploy:
    jobs:
      - build
      - test
      # - deploy:
      #     requires:
      #       - build
      #     filters:
      #       branches:
      #         only: master

##################
# Job Definitions
##################
jobs:
  build:
    docker:
      - image: circleci/python:3.9.4
        environment:
          FLASK_CONFIG: testing
    steps:
      - checkout
      - run:
          name: Install dependents
          command: |
            set -e
            python3 -m venv env/
            . env/bin/activate
            pip install -r requirements/docker.txt
            pytest
            pylint src
  test:
    steps:
      - checkout
      - run:
          name: Run unit and system tests
          command: |
            pytest
            pylint src


            
  # deploy:
  #   executor: heroku/default
  #   steps:
  #     - checkout
  #     - add_ssh_keys:
  #         fingerprints:
  #           - '48:a0:87:54:ca:75:32:12:c6:9e:a2:77:a4:7a:08:a4'
  #     - heroku/install
  #     - heroku/deploy-via-git:
  #         force: true